import{d as t,r as e,c as i,e as a,f as o,x as s,h as n,t as r,y as l,z as c,A as h,_ as p,B as d,u,w as m,o as g,C as y,D as f,G as w,n as v,H as b,F as _,i as x,E as C,I,J as k,l as D,j as V,K as j,L as S}from"./index-26b86a81.js";import{E as T}from"./el-button-bf5e0c7c.js";import{a as L}from"./anime.es-826e4a6c.js";import{E as A}from"./el-dialog-1a4b5cf1.js";function E(t){var e=t;if(/^(rgb|RGB)/.test(e)){for(var i=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),a="#",o=0;o<i.length;o++){var s=Number(i[o]).toString(16);s.length<2&&(s="0"+s),a+=s}return 7!==a.length&&(a=e),a}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){var n=e.replace(/#/,"").split("");if(6===n.length)return e;if(3===n.length){var r="#";for(o=0;o<n.length;o+=1)r+=n[o]+n[o];return r}}return e}function z(t,e){var i=t.toLowerCase();if(i&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(i)){if(4===i.length){for(var a="#",o=1;o<4;o+=1)a+=i.slice(o,o+1).concat(i.slice(o,o+1));i=a}var s=[];for(o=1;o<7;o+=2)s.push(parseInt("0x"+i.slice(o,o+2)));return"rgba("+s.join(",")+","+e+")"}return i}var B=function(){function t(t,e){this.container=document.querySelector(t),this.options=Object.assign({number:3,smooth:50,velocity:1,height:.3,colors:["#ff7657"],border:{show:!1,width:2,color:[""]},opacity:.5,position:"bottom"},e),this.lines=[],this.frame=null,this.step=0,this.status="pause",this.init(),this.draw()}return t.prototype.init=function(){if(null===this.container.querySelector("canvas")){var t=document.createElement("canvas");this.container.appendChild(t)}this.canvas=this.container.querySelector("canvas"),this.canvas.width=this.container.offsetWidth,this.canvas.height=this.container.offsetHeight,this.ctx=this.canvas.getContext("2d"),this.setLines()},t.prototype.animate=function(){this.status="animating",this.draw()},t.prototype.pause=function(){cancelAnimationFrame(this.frame),this.frame=null,this.status="pause"},t.prototype.setOptions=function(t){this.options=Object.assign(this.options,t),this.setLines(),this.reset(),"pause"===this.status&&this.draw()},t.prototype.reset=function(){this.init()},t.prototype.draw=function(){var t=this,e=this.canvas,i=this.ctx,a=this.getWaveHeight();i.clearRect(0,0,e.width,e.height),this.step+=this.options.velocity,this.lines.forEach((function(o,s){var n=(t.step+180*s/t.lines.length)*Math.PI/180,r=Math.sin(n)*t.options.smooth,l=Math.cos(n)*t.options.smooth,c=t.getVertexs(r,l);i.fillStyle=o.rgba,i.beginPath(),i.moveTo(c[0][0],c[0][1]),t.options.border.show&&(i.lineWidth=t.options.border.width,i.strokeStyle=t.options.border.color[s]?t.options.border.color[s]:o.hex),"left"===t.options.position||"right"===t.options.position?i.bezierCurveTo(a+r-t.options.smooth,e.height/2,a+l-t.options.smooth,e.width/2,c[1][0],c[1][1]):i.bezierCurveTo(e.width/2,a+r-t.options.smooth,e.width/2,a+l-t.options.smooth,c[1][0],c[1][1]),t.options.border.show&&i.stroke(),i.lineTo(c[2][0],c[2][1]),i.lineTo(c[3][0],c[3][1]),i.lineTo(c[0][0],c[0][1]),i.closePath(),i.fill()}));var o=this;"animating"===this.status&&(this.frame=requestAnimationFrame((function(){o.draw()})))},t.prototype.setLines=function(){this.lines=[];for(var t=0;t<this.options.number;t++){var e=this.options.colors[t%this.options.colors.length],i={hex:E(e),rgba:z(e,this.options.opacity)};this.lines.push(i)}},t.prototype.getVertexs=function(t,e){var i=this.canvas.height,a=this.canvas.width,o=this.getWaveHeight();switch(this.options.position){case"bottom":return[[0,o+t],[a,o+e],[a,i],[0,i]];case"top":return[[0,o+t],[a,o+e],[a,0],[0,0]];case"left":return[[o+t,0],[o+e,i],[0,i],[0,0]];case"right":return[[o+t,0],[o+e,i],[a,i],[a,0]]}},t.prototype.getWaveHeight=function(){if(this.options.height>1)switch(this.options.position){case"bottom":return this.canvas.height-this.options.height;case"top":case"left":return this.options.height;case"right":return this.canvas.width-this.options.height}else switch(this.options.position){case"bottom":return this.canvas.height*(1-this.options.height);case"top":return this.canvas.height*this.options.height;case"left":return this.canvas.width*this.options.height;case"right":return this.canvas.width*(1-this.options.height)}},t}();const H={class:"dialog-footer"},P=c("取消"),R=c("确定"),W=t({__name:"tologindialog",props:{isshow:{type:Boolean,default:!1},info:{type:String,default:'"你当前尚未登录无法点赞，是否前往登录页面？"'}},emits:["back"],setup(t,{emit:c}){const p=e({toLoginDialogText:"",isToLoginVisible:!1}),d=()=>{p.isToLoginVisible=!1,h.push({path:"/login"})};return(e,h)=>{const p=T,u=A;return i(),a("div",null,[o(u,{modelValue:t.isshow,"onUpdate:modelValue":h[1]||(h[1]=t=>l(isshow)?isshow.value=t:null),title:"登陆提示",width:"20%",top:"20rem","show-close":!1,"lock-scroll":!1},{footer:s((()=>[n("span",H,[o(p,{onClick:h[0]||(h[0]=t=>c("back"))},{default:s((()=>[P])),_:1}),o(p,{type:"success",onClick:d},{default:s((()=>[R])),_:1})])])),default:s((()=>[n("span",null,r(t.info),1)])),_:1},8,["modelValue"])])}}});const q={class:"interaction_body"},O={class:"interaction__inputbody"},$={class:"interaction__btnbody"},F={class:"interaction_comment flex-jcc-aic"},G=["index"],M={class:"interaction_comment_img"},U=["src"],J={class:"interaction_comment_container"},K={class:"interaction_comment_top"},N={class:"interaction_name"},Y={class:"interaction_time"},Q={class:"interaction_time"},X=["onClick"],Z={class:"interaction_comment_bottom"},tt=["onClick"],et=["src"],it={class:"reply"},at=["onClick"],ot={style:{color:"rgb(135, 168, 235)"}},st={key:0,class:"replydialog"},nt=c("评论");var rt=p(t({__name:"interaction",setup(t){let l=d(),h=u();const p=e({textarea:"",commentData:[],isshowtologindialog:!1,isshowwave:0,userid:localStorage.getItem("id"),username:localStorage.getItem("name"),userhasbeenlaudData:[],replycontent:"",newopenreplydialogIndex:-1,themeColor:h.state.themeColor,containerOpacity:1});m(h.state,((t,e)=>{p.themeColor=t.themeColor})),g((async()=>{L({targets:[".interaction_body_container"],translateY:"-10vh",opacity:1,duration:1e3});new B(".wave",{number:5,smooth:90,velocity:.3,height:100,colors:["#3498db","#9b59b6","#2980b9","#8e44ad","#74b9ff"],opacity:.2,position:"bottom",border:{show:!1,width:2,color:[]}}).animate(),p.isshowwave=1,p.commentData=await(await y()).data.data,p.commentData.map((t=>{t.isopenreply=!1})),p.userid&&R()}));const A=()=>{L({targets:[".interaction_body_container"],opacity:0,duration:1e3})},E=async()=>{if(!p.userid||p.username,""==p.textarea||p.textarea.length<5)return C.error("您输入的字数不够哦！");let{ip:t}=await I();200==(await k(p.userid||"-1",p.username||"游客",p.textarea,p.userid?"1":"-1",0,-1,t)).status?(p.commentData=await(await y()).data.data,R(),C.success("留言成功！"),p.textarea=""):C.error("留言失败！")},z=(t,e)=>{if(e==p.newopenreplydialogIndex)return p.newopenreplydialogIndex=-1,void(t.isopenreply=!1);-1!=p.newopenreplydialogIndex&&(p.commentData[p.newopenreplydialogIndex].isopenreply=!1),t.isopenreply=!0,p.newopenreplydialogIndex=e},H=async()=>{if(!p.userid||!p.username)return C.error("未登录");if(""==p.replycontent)return C.error("内容不能为空！");let{ip:t}=await I();201!=(await k(p.userid,p.username,p.replycontent,"1",1,p.commentData[p.newopenreplydialogIndex].id,t)).status?(p.commentData=await(await y()).data.data,p.commentData[p.newopenreplydialogIndex].isopenreply=!1,p.newopenreplydialogIndex=-1,p.replycontent="",C.success("评论成功！")):C.error("评论失败！！")},P=()=>{p.isshowtologindialog=!1},R=async()=>{const t=await f(parseInt(p.userid||"-1"));p.userhasbeenlaudData=t.data.data.map((t=>t.interactionid)),p.commentData.forEach((t=>{p.userhasbeenlaudData.includes(t.id)?t.islaud=!0:t.islaud=!1}))};return(t,e)=>{const h=w,d=T;return i(),a(_,null,[n("div",{class:"interaction_container",style:v({backgroundImage:`linear-gradient(${p.themeColor.start},${p.themeColor.end})`})},[o(D,{bgColor:!0,onChangePage:A}),n("div",q,[n("div",{class:"interaction_body_container",style:v({backgroundColor:3==p.themeColor.id?"rgba(243, 243, 255, 0.9)":"rgba(243, 243, 255, 0.7)"})},[n("h1",null,r(b(l).t("interaction.title")),1),n("div",O,[o(h,{modelValue:p.textarea,"onUpdate:modelValue":e[0]||(e[0]=t=>p.textarea=t),rows:2,type:"textarea",placeholder:b(l).t("interaction.textarea"),autosize:{minRows:5,maxRows:6}},null,8,["modelValue","placeholder"]),n("div",$,[n("span",null,r(b(l).t("interaction.info")),1),o(d,{type:"primary",class:"submitbtn",onClick:E},{default:s((()=>[c(r(b(l).t("interaction.submitinfo")),1)])),_:1})])]),n("div",F,[(i(!0),a(_,null,x(p.commentData,((t,l)=>(i(),a("div",{class:"interaction_comment_item",index:t.id},[n("div",M,[n("img",{src:t.avatar||"http://hyyyh.top:3001/icon/github.png",alt:""},null,8,U)]),n("div",J,[n("div",K,[n("span",N,r(t.username)+r("1"===t.userid?"(博主)":""),1),n("span",Y,r(t.createtime),1),n("span",Q,"IP:"+r(t.userip),1)]),n("div",{class:"interaction_comment_mid",onClick:e=>z(t,l)},r(t.container),9,X),n("div",Z,[n("div",{onClick:e=>(async t=>{if(!p.userid)return p.isshowtologindialog=!0;{if(201==(await j(t.id,parseInt(p.userid))).status)return void C.error("你已经点赞过了！");const e=await S(t.id,parseInt(p.userid));200==e.status&&(C.success(e.data.msg),t.laudnum++,t.islaud=!0)}})(t)},[n("img",{src:t.islaud?"http://hyyyh.top:3001/icon/laud_0.png":"http://hyyyh.top:3001/icon/laud.png",alt:""},null,8,et),c(r(t.laudnum),1)],8,tt),n("div",it,[n("span",{onClick:e=>z(t,l)},"回复",8,at)])]),(i(!0),a(_,null,x(t.childen,((e,o)=>(i(),a("div",{key:o,class:"replycontainer"},[n("span",null,[n("span",ot,r(e.username)+r("1"===t.userid?"(博主)":""),1),c(":"+r(e.container),1)])])))),128)),t.isopenreply?(i(),a("div",st,[o(h,{class:"replytextarea",type:"textarea",modelValue:p.replycontent,"onUpdate:modelValue":e[1]||(e[1]=t=>p.replycontent=t)},null,8,["modelValue"]),o(d,{class:"replybtn",type:"primary",onClick:H},{default:s((()=>[nt])),_:1})])):V("",!0)])],8,G)))),256))])],4)])],4),o(W,{isshow:p.isshowtologindialog,onBack:P},null,8,["isshow"]),n("div",{class:"wave",style:v({opacity:p.isshowwave,zIndex:0})},null,4)],64)}}}),[["__scopeId","data-v-14f4897e"]]);export{rt as default};
