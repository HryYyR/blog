import{d as k,r as C,c as d,e as _,f as c,u as y,h as e,t as m,x as $,y as g,z as j,_ as S,o as z,A as D,B as L,F as x,i as B,p as R,k as N,E as r,C as E,D as A,l as T,j as U,G as M,H as G,I as H}from"./index-6a377334.js";import{E as I}from"./el-button-b7e5276e.js";import{E as P}from"./el-input-65040a39.js";import{a as Y}from"./anime.es-826e4a6c.js";import{E as q}from"./el-overlay-4a345443.js";import"./index-92a1a46e.js";import"./index-eb87d129.js";const J={class:"dialog-footer"},K=g("\u53D6\u6D88"),O=g("\u786E\u5B9A"),Q=k({__name:"tologindialog",props:{isshow:{type:Boolean,default:!1},info:{type:String,default:'"\u4F60\u5F53\u524D\u5C1A\u672A\u767B\u5F55\u65E0\u6CD5\u70B9\u8D5E\uFF0C\u662F\u5426\u524D\u5F80\u767B\u5F55\u9875\u9762\uFF1F"'}},emits:["back"],setup(s,{emit:t}){const b=C({toLoginDialogText:"",isToLoginVisible:!1}),f=()=>{b.isToLoginVisible=!1,j.push({path:"/login"})};return(v,u)=>{const h=I,o=q;return d(),_("div",null,[c(o,{modelValue:s.isshow,"onUpdate:modelValue":u[1]||(u[1]=n=>$(isshow)?isshow.value=n:null),title:"\u767B\u9646\u63D0\u793A",width:"20%",top:"20rem","show-close":!1,"lock-scroll":!1},{footer:y(()=>[e("span",J,[c(h,{onClick:u[0]||(u[0]=n=>t("back"))},{default:y(()=>[K]),_:1}),c(h,{type:"success",onClick:f},{default:y(()=>[O]),_:1})])]),default:y(()=>[e("span",null,m(s.info),1)]),_:1},8,["modelValue"])])}}});const w=s=>(R("data-v-194e05ac"),s=s(),N(),s),W={class:"interaction_container"},X={class:"interaction_body"},Z={class:"interaction_body_container"},tt=w(()=>e("h1",null,"\u7559\u8A00\u677F",-1)),et={class:"interaction__inputbody"},nt={class:"interaction__btnbody"},ot=w(()=>e("span",null,"(\u5EFA\u8BAE\u767B\u9646\u540E\u8BC4\u8BBA\u54E6\uFF01)",-1)),it=g("\u63D0\u4EA4\u7559\u8A00"),at={class:"interaction_comment"},rt=["index"],ct=w(()=>e("div",{class:"interaction_comment_img"},[e("img",{src:"http://hyyyh.top:3001/icon/github.png",alt:""})],-1)),st={class:"interaction_comment_container"},lt={class:"interaction_comment_top"},dt={class:"interaction_name"},_t={class:"interaction_time"},mt=["onClick"],ut={class:"interaction_comment_bottom"},pt=["onClick"],yt=["src"],gt={class:"reply"},ht=["onClick"],bt={style:{color:"skyblue"}},ft={key:0,class:"replydialog"},vt=g("\u8BC4\u8BBA"),xt=k({__name:"interaction",setup(s){const t=C({textarea:"",commentData:[],isshowtologindialog:!1,userid:localStorage.getItem("id"),username:localStorage.getItem("name"),userhasbeenlaudData:[],replycontent:"",newopenreplydialogIndex:-1});z(async()=>{if(Y({targets:[".interaction_body_container"],translateY:"-50vh",opacity:1,duration:1e3}),t.commentData=await(await D()).data.data,t.commentData.map(o=>{o.isopenreply=!1}),t.userid){const o=await L(parseInt(t.userid));t.userhasbeenlaudData=o.data.data.map(n=>n.interactionid),t.commentData.map(n=>{t.userhasbeenlaudData.includes(n.id)?n.islaud=!0:n.islaud=!1})}});const b=async()=>{if(!t.userid||!t.username)return r.error("\u672A\u767B\u5F55");if(t.textarea==""||t.textarea.length<5)return r.error("\u60A8\u8F93\u5165\u7684\u5B57\u6570\u4E0D\u591F\u54E6\uFF01");let{path:o,ip:n}=await E();const a=await A(t.userid,t.username,t.textarea,"1",0,-1,n,o);a.status==200?(t.commentData=a.data.data,t.commentData.map(p=>{t.userhasbeenlaudData.includes(p.id)?p.islaud=!0:p.islaud=!1}),r.success("\u7559\u8A00\u6210\u529F\uFF01")):r.error("\u7559\u8A00\u5931\u8D25\uFF01")},f=async o=>{if(t.userid){const n=await G(o.id,parseInt(t.userid));if(console.log(n),n.status==201){r.error("\u4F60\u5DF2\u7ECF\u70B9\u8D5E\u8FC7\u4E86\uFF01");return}const a=await H(o.id,parseInt(t.userid));a.status==200&&(r.success(a.data.msg),o.laudnum++,o.islaud=!0),console.log(a)}else return t.isshowtologindialog=!0},v=(o,n)=>{if(n==t.newopenreplydialogIndex){t.newopenreplydialogIndex=-1,o.isopenreply=!1;return}t.newopenreplydialogIndex!=-1&&(t.commentData[t.newopenreplydialogIndex].isopenreply=!1),o.isopenreply=!0,t.newopenreplydialogIndex=n},u=async()=>{if(!t.userid||!t.username)return r.error("\u672A\u767B\u5F55");if(t.replycontent=="")return r.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let{path:o,ip:n}=await E();if((await A(t.userid,t.username,t.replycontent,"1",1,t.commentData[t.newopenreplydialogIndex].id,n,o)).status==201){r.error("\u8BC4\u8BBA\u5931\u8D25\uFF01\uFF01");return}t.commentData=await(await D()).data.data,t.commentData[t.newopenreplydialogIndex].isopenreply=!1,t.newopenreplydialogIndex=-1,t.replycontent="",r.success("\u8BC4\u8BBA\u6210\u529F\uFF01")},h=()=>{t.isshowtologindialog=!1};return(o,n)=>{const a=P,p=I;return d(),_(x,null,[e("div",W,[c(T,{bgColor:!0}),e("div",X,[e("div",Z,[tt,e("div",et,[c(a,{modelValue:t.textarea,"onUpdate:modelValue":n[0]||(n[0]=i=>t.textarea=i),rows:2,type:"textarea",placeholder:"\u7559\u4E0B\u4F60\u7684\u5EFA\u8BAE\u5427\uFF01",autosize:{minRows:5,maxRows:6}},null,8,["modelValue"]),e("div",nt,[ot,c(p,{type:"primary",class:"submitbtn",onClick:b},{default:y(()=>[it]),_:1})])]),e("div",at,[(d(!0),_(x,null,B(t.commentData,(i,F)=>(d(),_("div",{class:"interaction_comment_item",index:i.id},[ct,e("div",st,[e("div",lt,[e("span",dt,m(i.username),1),e("span",_t,m(i.createtime),1)]),e("div",{class:"interaction_comment_mid",onClick:l=>v(i,F)},m(i.container),9,mt),e("div",ut,[e("div",{onClick:l=>f(i)},[e("img",{src:i.islaud?"http://hyyyh.top:3001/icon/laud_0.png":"http://hyyyh.top:3001/icon/laud.png",alt:""},null,8,yt),g(m(i.laudnum),1)],8,pt),e("div",gt,[e("span",{onClick:l=>v(i,F)},"\u56DE\u590D",8,ht)])]),(d(!0),_(x,null,B(i.childen,(l,V)=>(d(),_("div",{key:V,class:"replycontainer"},[e("span",null,[e("span",bt,m(l.username),1),g(":"+m(l.container),1)])]))),128)),i.isopenreply?(d(),_("div",ft,[c(a,{class:"replytextarea",type:"textarea",modelValue:t.replycontent,"onUpdate:modelValue":n[1]||(n[1]=l=>t.replycontent=l)},null,8,["modelValue"]),c(p,{class:"replybtn",type:"primary",onClick:u},{default:y(()=>[vt]),_:1})])):U("",!0)])],8,rt))),256))])]),c(M)])]),c(Q,{isshow:t.isshowtologindialog,onBack:h},null,8,["isshow"])],64)}}});var Ct=S(xt,[["__scopeId","data-v-194e05ac"]]);export{Ct as default};
