import{d as E,r as C,c as f,e as g,f as _,x as b,h as a,t as p,y as S,z as v,A as j,_ as T,o as $,B as F,C as z,F as w,i as B,n as L,p as R,k as H,E as m,D,G as A,l as W,j as M,H as N,I as P,J as q}from"./index-993abf4f.js";import{E as k}from"./el-button-da3e873c.js";import{E as G}from"./el-input-f0519e1d.js";import{a as O}from"./anime.es-826e4a6c.js";import{E as U}from"./el-overlay-96745e7a.js";import"./index-b4fcafc8.js";import"./index-6b52bb73.js";function J(c){var t=c;if(/^(rgb|RGB)/.test(t)){for(var i=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),n="#",e=0;e<i.length;e++){var r=Number(i[e]).toString(16);r.length<2&&(r="0"+r),n+=r}return n.length!==7&&(n=t),n}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){var u=t.replace(/#/,"").split("");if(u.length===6)return t;if(u.length===3){var l="#";for(e=0;e<u.length;e+=1)l+=u[e]+u[e];return l}}return t}function Y(c,t){var i=c.toLowerCase();if(i&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(i)){if(i.length===4){for(var n="#",e=1;e<4;e+=1)n+=i.slice(e,e+1).concat(i.slice(e,e+1));i=n}var r=[];for(e=1;e<7;e+=2)r.push(parseInt("0x"+i.slice(e,e+2)));return"rgba("+r.join(",")+","+t+")"}return i}var K=function(){function c(t,i){this.container=document.querySelector(t),this.options=Object.assign({number:3,smooth:50,velocity:1,height:.3,colors:["#ff7657"],border:{show:!1,width:2,color:[""]},opacity:.5,position:"bottom"},i),this.lines=[],this.frame=null,this.step=0,this.status="pause",this.init(),this.draw()}return c.prototype.init=function(){if(this.container.querySelector("canvas")===null){var t=document.createElement("canvas");this.container.appendChild(t)}this.canvas=this.container.querySelector("canvas"),this.canvas.width=this.container.offsetWidth,this.canvas.height=this.container.offsetHeight,this.ctx=this.canvas.getContext("2d"),this.setLines()},c.prototype.animate=function(){this.status="animating",this.draw()},c.prototype.pause=function(){cancelAnimationFrame(this.frame),this.frame=null,this.status="pause"},c.prototype.setOptions=function(t){this.options=Object.assign(this.options,t),this.setLines(),this.reset(),this.status==="pause"&&this.draw()},c.prototype.reset=function(){this.init()},c.prototype.draw=function(){var t=this,i=this.canvas,n=this.ctx,e=this.getWaveHeight();n.clearRect(0,0,i.width,i.height),this.step+=this.options.velocity,this.lines.forEach(function(u,l){var s=(t.step+180*l/t.lines.length)*Math.PI/180,d=Math.sin(s)*t.options.smooth,y=Math.cos(s)*t.options.smooth,o=t.getVertexs(d,y);n.fillStyle=u.rgba,n.beginPath(),n.moveTo(o[0][0],o[0][1]),t.options.border.show&&(n.lineWidth=t.options.border.width,n.strokeStyle=t.options.border.color[l]?t.options.border.color[l]:u.hex),t.options.position==="left"||t.options.position==="right"?n.bezierCurveTo(e+d-t.options.smooth,i.height/2,e+y-t.options.smooth,i.width/2,o[1][0],o[1][1]):n.bezierCurveTo(i.width/2,e+d-t.options.smooth,i.width/2,e+y-t.options.smooth,o[1][0],o[1][1]),t.options.border.show&&n.stroke(),n.lineTo(o[2][0],o[2][1]),n.lineTo(o[3][0],o[3][1]),n.lineTo(o[0][0],o[0][1]),n.closePath(),n.fill()});var r=this;this.status==="animating"&&(this.frame=requestAnimationFrame(function(){r.draw()}))},c.prototype.setLines=function(){this.lines=[];for(var t=0;t<this.options.number;t++){var i=this.options.colors[t%this.options.colors.length],n={hex:J(i),rgba:Y(i,this.options.opacity)};this.lines.push(n)}},c.prototype.getVertexs=function(t,i){var n=this.canvas.height,e=this.canvas.width,r=this.getWaveHeight();switch(this.options.position){case"bottom":return[[0,r+t],[e,r+i],[e,n],[0,n]];case"top":return[[0,r+t],[e,r+i],[e,0],[0,0]];case"left":return[[r+t,0],[r+i,n],[0,n],[0,0]];case"right":return[[r+t,0],[r+i,n],[e,n],[e,0]]}},c.prototype.getWaveHeight=function(){if(this.options.height>1)switch(this.options.position){case"bottom":return this.canvas.height-this.options.height;case"top":case"left":return this.options.height;case"right":return this.canvas.width-this.options.height}else switch(this.options.position){case"bottom":return this.canvas.height*(1-this.options.height);case"top":return this.canvas.height*this.options.height;case"left":return this.canvas.width*this.options.height;case"right":return this.canvas.width*(1-this.options.height)}},c}();const Q={class:"dialog-footer"},X=v("\u53D6\u6D88"),Z=v("\u786E\u5B9A"),tt=E({__name:"tologindialog",props:{isshow:{type:Boolean,default:!1},info:{type:String,default:'"\u4F60\u5F53\u524D\u5C1A\u672A\u767B\u5F55\u65E0\u6CD5\u70B9\u8D5E\uFF0C\u662F\u5426\u524D\u5F80\u767B\u5F55\u9875\u9762\uFF1F"'}},emits:["back"],setup(c,{emit:t}){const i=C({toLoginDialogText:"",isToLoginVisible:!1}),n=()=>{i.isToLoginVisible=!1,j.push({path:"/login"})};return(e,r)=>{const u=k,l=U;return f(),g("div",null,[_(l,{modelValue:c.isshow,"onUpdate:modelValue":r[1]||(r[1]=s=>S(isshow)?isshow.value=s:null),title:"\u767B\u9646\u63D0\u793A",width:"20%",top:"20rem","show-close":!1,"lock-scroll":!1},{footer:b(()=>[a("span",Q,[_(u,{onClick:r[0]||(r[0]=s=>t("back"))},{default:b(()=>[X]),_:1}),_(u,{type:"success",onClick:n},{default:b(()=>[Z]),_:1})])]),default:b(()=>[a("span",null,p(c.info),1)]),_:1},8,["modelValue"])])}}});const I=c=>(R("data-v-623aa0f3"),c=c(),H(),c),et={class:"interaction_container"},nt={class:"interaction_body"},it={class:"interaction_body_container"},ot=I(()=>a("h1",null,"\u7559\u8A00\u677F",-1)),at={class:"interaction__inputbody"},rt={class:"interaction__btnbody"},st=I(()=>a("span",null,"(\u5EFA\u8BAE\u767B\u9646\u540E\u8BC4\u8BBA\u54E6\uFF01)",-1)),ct=v("\u63D0\u4EA4\u7559\u8A00"),lt={class:"interaction_comment"},dt=["index"],ut={class:"interaction_comment_img"},mt=["src"],_t={class:"interaction_comment_container"},pt={class:"interaction_comment_top"},ht={class:"interaction_name"},ft={class:"interaction_time"},gt={class:"interaction_time"},yt=["onClick"],bt={class:"interaction_comment_bottom"},vt=["onClick"],wt=["src"],xt={class:"reply"},Ft=["onClick"],Bt={style:{color:"rgb(135, 168, 235)"}},Dt={key:0,class:"replydialog"},At=v("\u8BC4\u8BBA"),Et=E({__name:"interaction",setup(c){const t=C({textarea:"",commentData:[],isshowtologindialog:!1,isshowwave:0,userid:localStorage.getItem("id"),username:localStorage.getItem("name"),userhasbeenlaudData:[],replycontent:"",newopenreplydialogIndex:-1});$(async()=>{if(O({targets:[".interaction_body_container"],translateY:"-50vh",opacity:1,duration:1e3}),new K(".wave",{number:5,smooth:90,velocity:.3,height:100,colors:["#3498db","#9b59b6","#2980b9","#8e44ad","#74b9ff"],opacity:.2,position:"bottom",border:{show:!1,width:2,color:[]}}).animate(),t.isshowwave=1,t.commentData=await(await F()).data.data,t.commentData.map(s=>{s.isopenreply=!1}),t.userid){const s=await z(parseInt(t.userid));t.userhasbeenlaudData=s.data.data.map(d=>d.interactionid),t.commentData.map(d=>{t.userhasbeenlaudData.includes(d.id)?d.islaud=!0:d.islaud=!1})}});const i=async()=>{if(!t.userid||!t.username)return m.error("\u672A\u767B\u5F55");if(t.textarea==""||t.textarea.length<5)return m.error("\u60A8\u8F93\u5165\u7684\u5B57\u6570\u4E0D\u591F\u54E6\uFF01");let{ip:l}=await D();const s=await A(t.userid,t.username,t.textarea,"1",0,-1,l);s.status==200?(t.commentData=s.data.data,t.commentData.map(d=>{t.userhasbeenlaudData.includes(d.id)?d.islaud=!0:d.islaud=!1}),m.success("\u7559\u8A00\u6210\u529F\uFF01"),t.textarea=""):m.error("\u7559\u8A00\u5931\u8D25\uFF01")},n=async l=>{if(t.userid){const s=await P(l.id,parseInt(t.userid));if(console.log(s),s.status==201){m.error("\u4F60\u5DF2\u7ECF\u70B9\u8D5E\u8FC7\u4E86\uFF01");return}const d=await q(l.id,parseInt(t.userid));d.status==200&&(m.success(d.data.msg),l.laudnum++,l.islaud=!0),console.log(d)}else return t.isshowtologindialog=!0},e=(l,s)=>{if(s==t.newopenreplydialogIndex){t.newopenreplydialogIndex=-1,l.isopenreply=!1;return}t.newopenreplydialogIndex!=-1&&(t.commentData[t.newopenreplydialogIndex].isopenreply=!1),l.isopenreply=!0,t.newopenreplydialogIndex=s},r=async()=>{if(!t.userid||!t.username)return m.error("\u672A\u767B\u5F55");if(t.replycontent=="")return m.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let{ip:l}=await D();if((await A(t.userid,t.username,t.replycontent,"1",1,t.commentData[t.newopenreplydialogIndex].id,l)).status==201){m.error("\u8BC4\u8BBA\u5931\u8D25\uFF01\uFF01");return}t.commentData=await(await F()).data.data,t.commentData[t.newopenreplydialogIndex].isopenreply=!1,t.newopenreplydialogIndex=-1,t.replycontent="",m.success("\u8BC4\u8BBA\u6210\u529F\uFF01")},u=()=>{t.isshowtologindialog=!1};return(l,s)=>{const d=G,y=k;return f(),g(w,null,[a("div",et,[_(W,{bgColor:!0}),a("div",nt,[a("div",it,[ot,a("div",at,[_(d,{modelValue:t.textarea,"onUpdate:modelValue":s[0]||(s[0]=o=>t.textarea=o),rows:2,type:"textarea",placeholder:"\u7559\u4E0B\u4F60\u7684\u5EFA\u8BAE\u5427\uFF01",autosize:{minRows:5,maxRows:6}},null,8,["modelValue"]),a("div",rt,[st,_(y,{type:"primary",class:"submitbtn",onClick:i},{default:b(()=>[ct]),_:1})])]),a("div",lt,[(f(!0),g(w,null,B(t.commentData,(o,x)=>(f(),g("div",{class:"interaction_comment_item",index:o.id},[a("div",ut,[a("img",{src:o.avatar||"http://hyyyh.top:3001/icon/github.png",alt:""},null,8,mt)]),a("div",_t,[a("div",pt,[a("span",ht,p(o.username),1),a("span",ft,p(o.createtime),1),a("span",gt,"IP:"+p(o.userip),1)]),a("div",{class:"interaction_comment_mid",onClick:h=>e(o,x)},p(o.container),9,yt),a("div",bt,[a("div",{onClick:h=>n(o)},[a("img",{src:o.islaud?"http://hyyyh.top:3001/icon/laud_0.png":"http://hyyyh.top:3001/icon/laud.png",alt:""},null,8,wt),v(p(o.laudnum),1)],8,vt),a("div",xt,[a("span",{onClick:h=>e(o,x)},"\u56DE\u590D",8,Ft)])]),(f(!0),g(w,null,B(o.childen,(h,V)=>(f(),g("div",{key:V,class:"replycontainer"},[a("span",null,[a("span",Bt,p(h.username),1),v(":"+p(h.container),1)])]))),128)),o.isopenreply?(f(),g("div",Dt,[_(d,{class:"replytextarea",type:"textarea",modelValue:t.replycontent,"onUpdate:modelValue":s[1]||(s[1]=h=>t.replycontent=h)},null,8,["modelValue"]),_(y,{class:"replybtn",type:"primary",onClick:r},{default:b(()=>[At]),_:1})])):M("",!0)])],8,dt))),256))])]),_(N)])]),_(tt,{isshow:t.isshowtologindialog,onBack:u},null,8,["isshow"]),a("div",{class:"wave",style:L({opacity:t.isshowwave})},null,4)],64)}}});var $t=T(Et,[["__scopeId","data-v-623aa0f3"]]);export{$t as default};
