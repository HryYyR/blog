import{d as I,r as k,l as f,c as b,e as h,z as v,f as a,t as g,A as z,B as w,C as T,_ as j,u as L,w as R,o as H,D as x,G as W,n as F,F as B,h as D,p as M,k as N,E as p,H as A,I as E,m as P,i as q,J as G,K as O}from"./index-d3891d0c.js";import{E as V}from"./el-button-b68aad91.js";import{E as U}from"./el-input-d4ec9a95.js";import{a as J}from"./anime.es-826e4a6c.js";import{E as K}from"./el-overlay-6355051e.js";import"./index-c5d2c0da.js";import"./index-1b0c62bb.js";function Y(r){var e=r;if(/^(rgb|RGB)/.test(e)){for(var t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),n="#",i=0;i<t.length;i++){var o=Number(t[i]).toString(16);o.length<2&&(o="0"+o),n+=o}return n.length!==7&&(n=e),n}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){var m=e.replace(/#/,"").split("");if(m.length===6)return e;if(m.length===3){var _="#";for(i=0;i<m.length;i+=1)_+=m[i]+m[i];return _}}return e}function Q(r,e){var t=r.toLowerCase();if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(t.length===4){for(var n="#",i=1;i<4;i+=1)n+=t.slice(i,i+1).concat(t.slice(i,i+1));t=n}var o=[];for(i=1;i<7;i+=2)o.push(parseInt("0x"+t.slice(i,i+2)));return"rgba("+o.join(",")+","+e+")"}return t}var X=function(){function r(e,t){this.container=document.querySelector(e),this.options=Object.assign({number:3,smooth:50,velocity:1,height:.3,colors:["#ff7657"],border:{show:!1,width:2,color:[""]},opacity:.5,position:"bottom"},t),this.lines=[],this.frame=null,this.step=0,this.status="pause",this.init(),this.draw()}return r.prototype.init=function(){if(this.container.querySelector("canvas")===null){var e=document.createElement("canvas");this.container.appendChild(e)}this.canvas=this.container.querySelector("canvas"),this.canvas.width=this.container.offsetWidth,this.canvas.height=this.container.offsetHeight,this.ctx=this.canvas.getContext("2d"),this.setLines()},r.prototype.animate=function(){this.status="animating",this.draw()},r.prototype.pause=function(){cancelAnimationFrame(this.frame),this.frame=null,this.status="pause"},r.prototype.setOptions=function(e){this.options=Object.assign(this.options,e),this.setLines(),this.reset(),this.status==="pause"&&this.draw()},r.prototype.reset=function(){this.init()},r.prototype.draw=function(){var e=this,t=this.canvas,n=this.ctx,i=this.getWaveHeight();n.clearRect(0,0,t.width,t.height),this.step+=this.options.velocity,this.lines.forEach(function(m,_){var s=(e.step+180*_/e.lines.length)*Math.PI/180,c=Math.sin(s)*e.options.smooth,l=Math.cos(s)*e.options.smooth,d=e.getVertexs(c,l);n.fillStyle=m.rgba,n.beginPath(),n.moveTo(d[0][0],d[0][1]),e.options.border.show&&(n.lineWidth=e.options.border.width,n.strokeStyle=e.options.border.color[_]?e.options.border.color[_]:m.hex),e.options.position==="left"||e.options.position==="right"?n.bezierCurveTo(i+c-e.options.smooth,t.height/2,i+l-e.options.smooth,t.width/2,d[1][0],d[1][1]):n.bezierCurveTo(t.width/2,i+c-e.options.smooth,t.width/2,i+l-e.options.smooth,d[1][0],d[1][1]),e.options.border.show&&n.stroke(),n.lineTo(d[2][0],d[2][1]),n.lineTo(d[3][0],d[3][1]),n.lineTo(d[0][0],d[0][1]),n.closePath(),n.fill()});var o=this;this.status==="animating"&&(this.frame=requestAnimationFrame(function(){o.draw()}))},r.prototype.setLines=function(){this.lines=[];for(var e=0;e<this.options.number;e++){var t=this.options.colors[e%this.options.colors.length],n={hex:Y(t),rgba:Q(t,this.options.opacity)};this.lines.push(n)}},r.prototype.getVertexs=function(e,t){var n=this.canvas.height,i=this.canvas.width,o=this.getWaveHeight();switch(this.options.position){case"bottom":return[[0,o+e],[i,o+t],[i,n],[0,n]];case"top":return[[0,o+e],[i,o+t],[i,0],[0,0]];case"left":return[[o+e,0],[o+t,n],[0,n],[0,0]];case"right":return[[o+e,0],[o+t,n],[i,n],[i,0]]}},r.prototype.getWaveHeight=function(){if(this.options.height>1)switch(this.options.position){case"bottom":return this.canvas.height-this.options.height;case"top":case"left":return this.options.height;case"right":return this.canvas.width-this.options.height}else switch(this.options.position){case"bottom":return this.canvas.height*(1-this.options.height);case"top":return this.canvas.height*this.options.height;case"left":return this.canvas.width*this.options.height;case"right":return this.canvas.width*(1-this.options.height)}},r}();const Z={class:"dialog-footer"},tt=w("\u53D6\u6D88"),et=w("\u786E\u5B9A"),nt=I({__name:"tologindialog",props:{isshow:{type:Boolean,default:!1},info:{type:String,default:'"\u4F60\u5F53\u524D\u5C1A\u672A\u767B\u5F55\u65E0\u6CD5\u70B9\u8D5E\uFF0C\u662F\u5426\u524D\u5F80\u767B\u5F55\u9875\u9762\uFF1F"'}},emits:["back"],setup(r,{emit:e}){const t=k({toLoginDialogText:"",isToLoginVisible:!1}),n=()=>{t.isToLoginVisible=!1,T.push({path:"/login"})};return(i,o)=>{const m=V,_=K;return f(),b("div",null,[h(_,{modelValue:r.isshow,"onUpdate:modelValue":o[1]||(o[1]=s=>z(isshow)?isshow.value=s:null),title:"\u767B\u9646\u63D0\u793A",width:"20%",top:"20rem","show-close":!1,"lock-scroll":!1},{footer:v(()=>[a("span",Z,[h(m,{onClick:o[0]||(o[0]=s=>e("back"))},{default:v(()=>[tt]),_:1}),h(m,{type:"success",onClick:n},{default:v(()=>[et]),_:1})])]),default:v(()=>[a("span",null,g(r.info),1)]),_:1},8,["modelValue"])])}}});const S=r=>(M("data-v-e05899d2"),r=r(),N(),r),it={class:"interaction_body"},ot=S(()=>a("h1",null,"\u7559\u8A00\u677F",-1)),at={class:"interaction__inputbody"},rt={class:"interaction__btnbody"},st=S(()=>a("span",null,"(\u5EFA\u8BAE\u767B\u9646\u540E\u8BC4\u8BBA\u54E6\uFF01)",-1)),ct=w("\u63D0\u4EA4\u7559\u8A00"),lt={class:"interaction_comment"},dt=["index"],ut={class:"interaction_comment_img"},mt=["src"],_t={class:"interaction_comment_container"},pt={class:"interaction_comment_top"},ht={class:"interaction_name"},gt={class:"interaction_time"},yt={class:"interaction_time"},ft=["onClick"],bt={class:"interaction_comment_bottom"},vt=["onClick"],wt=["src"],xt={class:"reply"},Ft=["onClick"],Bt={style:{color:"rgb(135, 168, 235)"}},Ct={key:0,class:"replydialog"},Dt=w("\u8BC4\u8BBA"),At=I({__name:"interaction",setup(r){let e=L();const t=k({textarea:"",commentData:[],isshowtologindialog:!1,isshowwave:0,userid:localStorage.getItem("id"),username:localStorage.getItem("name"),userhasbeenlaudData:[],replycontent:"",newopenreplydialogIndex:-1,themeColor:e.state.themeColor});R(e.state,(s,c)=>{t.themeColor=s.themeColor}),H(async()=>{if(J({targets:[".interaction_body_container"],translateY:"-50vh",opacity:1,duration:1e3}),new X(".wave",{number:5,smooth:90,velocity:.3,height:100,colors:["#3498db","#9b59b6","#2980b9","#8e44ad","#74b9ff"],opacity:.2,position:"bottom",border:{show:!1,width:2,color:[]}}).animate(),t.isshowwave=1,t.commentData=await(await x()).data.data,t.commentData.map(c=>{c.isopenreply=!1}),t.userid){const c=await W(parseInt(t.userid));t.userhasbeenlaudData=c.data.data.map(l=>l.interactionid),t.commentData.map(l=>{t.userhasbeenlaudData.includes(l.id)?l.islaud=!0:l.islaud=!1})}});const n=async()=>{if(!t.userid||t.username,t.textarea==""||t.textarea.length<5)return p.error("\u60A8\u8F93\u5165\u7684\u5B57\u6570\u4E0D\u591F\u54E6\uFF01");let{ip:s}=await A();(await E(t.userid||"-1",t.username||"\u6E38\u5BA2",t.textarea,t.userid?"1":"-1",0,-1,s)).status==200?(t.commentData=await(await x()).data.data,t.commentData.map(l=>{t.userhasbeenlaudData.includes(l.id)?l.islaud=!0:l.islaud=!1}),p.success("\u7559\u8A00\u6210\u529F\uFF01"),t.textarea=""):p.error("\u7559\u8A00\u5931\u8D25\uFF01")},i=async s=>{if(t.userid){if((await G(s.id,parseInt(t.userid))).status==201){p.error("\u4F60\u5DF2\u7ECF\u70B9\u8D5E\u8FC7\u4E86\uFF01");return}const l=await O(s.id,parseInt(t.userid));l.status==200&&(p.success(l.data.msg),s.laudnum++,s.islaud=!0)}else return t.isshowtologindialog=!0},o=(s,c)=>{if(c==t.newopenreplydialogIndex){t.newopenreplydialogIndex=-1,s.isopenreply=!1;return}t.newopenreplydialogIndex!=-1&&(t.commentData[t.newopenreplydialogIndex].isopenreply=!1),s.isopenreply=!0,t.newopenreplydialogIndex=c},m=async()=>{if(!t.userid||!t.username)return p.error("\u672A\u767B\u5F55");if(t.replycontent=="")return p.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let{ip:s}=await A();if((await E(t.userid,t.username,t.replycontent,"1",1,t.commentData[t.newopenreplydialogIndex].id,s)).status==201){p.error("\u8BC4\u8BBA\u5931\u8D25\uFF01\uFF01");return}t.commentData=await(await x()).data.data,t.commentData[t.newopenreplydialogIndex].isopenreply=!1,t.newopenreplydialogIndex=-1,t.replycontent="",p.success("\u8BC4\u8BBA\u6210\u529F\uFF01")},_=()=>{t.isshowtologindialog=!1};return(s,c)=>{const l=U,d=V;return f(),b(B,null,[a("div",{class:"interaction_container",style:F({backgroundImage:`linear-gradient(${t.themeColor.start},${t.themeColor.end})`})},[h(P,{bgColor:!0}),a("div",it,[a("div",{class:"interaction_body_container",style:F({backgroundColor:t.themeColor.id==3?"rgba(243, 243, 255, 0.9)":"rgba(243, 243, 255, 0.7)"})},[ot,a("div",at,[h(l,{modelValue:t.textarea,"onUpdate:modelValue":c[0]||(c[0]=u=>t.textarea=u),rows:2,type:"textarea",placeholder:"\u7559\u4E0B\u4F60\u7684\u5EFA\u8BAE\u5427\uFF01",autosize:{minRows:5,maxRows:6}},null,8,["modelValue"]),a("div",rt,[st,h(d,{type:"primary",class:"submitbtn",onClick:n},{default:v(()=>[ct]),_:1})])]),a("div",lt,[(f(!0),b(B,null,D(t.commentData,(u,C)=>(f(),b("div",{class:"interaction_comment_item",index:u.id},[a("div",ut,[a("img",{src:u.avatar||"http://hyyyh.top:3001/icon/github.png",alt:""},null,8,mt)]),a("div",_t,[a("div",pt,[a("span",ht,g(u.username),1),a("span",gt,g(u.createtime),1),a("span",yt,"IP:"+g(u.userip),1)]),a("div",{class:"interaction_comment_mid",onClick:y=>o(u,C)},g(u.container),9,ft),a("div",bt,[a("div",{onClick:y=>i(u)},[a("img",{src:u.islaud?"http://hyyyh.top:3001/icon/laud_0.png":"http://hyyyh.top:3001/icon/laud.png",alt:""},null,8,wt),w(g(u.laudnum),1)],8,vt),a("div",xt,[a("span",{onClick:y=>o(u,C)},"\u56DE\u590D",8,Ft)])]),(f(!0),b(B,null,D(u.childen,(y,$)=>(f(),b("div",{key:$,class:"replycontainer"},[a("span",null,[a("span",Bt,g(y.username),1),w(":"+g(y.container),1)])]))),128)),u.isopenreply?(f(),b("div",Ct,[h(l,{class:"replytextarea",type:"textarea",modelValue:t.replycontent,"onUpdate:modelValue":c[1]||(c[1]=y=>t.replycontent=y)},null,8,["modelValue"]),h(d,{class:"replybtn",type:"primary",onClick:m},{default:v(()=>[Dt]),_:1})])):q("",!0)])],8,dt))),256))])],4)])],4),h(nt,{isshow:t.isshowtologindialog,onBack:_},null,8,["isshow"]),a("div",{class:"wave",style:F({opacity:t.isshowwave,zIndex:0})},null,4)],64)}}});var Tt=j(At,[["__scopeId","data-v-e05899d2"]]);export{Tt as default};
